{"version":3,"sources":["webpack:///E:/demo/hello2-mylogin/components/almost-lottery/almost-lottery.vue?248f","webpack:///E:/demo/hello2-mylogin/components/almost-lottery/almost-lottery.vue?6034","webpack:///E:/demo/hello2-mylogin/components/almost-lottery/almost-lottery.vue?033f","webpack:///E:/demo/hello2-mylogin/components/almost-lottery/almost-lottery.vue?8bec","uni-app:///components/almost-lottery/almost-lottery.vue","webpack:///E:/demo/hello2-mylogin/components/almost-lottery/almost-lottery.vue?b5fb","webpack:///E:/demo/hello2-mylogin/components/almost-lottery/almost-lottery.vue?460e"],"names":[],"mappings":"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","file":"components/almost-lottery/almost-lottery.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./almost-lottery.vue?vue&type=template&id=861fe3f8&scoped=true&\"\nvar renderjs\nimport script from \"./almost-lottery.vue?vue&type=script&lang=js&\"\nexport * from \"./almost-lottery.vue?vue&type=script&lang=js&\"\nimport style0 from \"./almost-lottery.vue?vue&type=style&index=0&id=861fe3f8&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"861fe3f8\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/almost-lottery/almost-lottery.vue\"\nexport default component.exports","export * from \"-!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./almost-lottery.vue?vue&type=template&id=861fe3f8&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./almost-lottery.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./almost-lottery.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"almost-lottery\" :style=\"{ width: canvasWidth + 44 + 'px', height: canvasHeight + 44 + 'px'}\">\r\n    <view class=\"almost-lottery-wrap\" :style=\"{width: canvasWidth + 'px', height: canvasHeight + 'px'}\">\r\n      <!-- #ifdef MP-ALIPAY -->\n      <canvas :class=\"className\" :id=\"canvasId\" :width=\"canvasWidth\" :height=\"canvasHeight\" :style=\"{\n         width: canvasWidth + 'px',\n         height: canvasHeight + 'px'\n       }\" />\n      <!-- #endif -->\n      <!-- #ifndef MP-ALIPAY -->\n      <canvas :class=\"className\" :canvas-id=\"canvasId\" :width=\"canvasWidth\" :height=\"canvasHeight\" :style=\"{\n         width: canvasWidth + 'px',\n         height: canvasHeight + 'px'\n       }\" />\n      <!-- #endif -->\r\n      <image class=\"canvas-img\" :src=\"canvasImg\" :style=\"{\r\n         width: canvasWidth + 'px',\r\n         height: canvasHeight + 'px',\r\n         transform: `rotate(${canvasAngle + targetAngle}deg)`,\r\n         transitionDuration: `${transitionDuration}s`\r\n       }\"\r\n        v-if=\"canvasImg\"></image>\r\n      <view class=\"almost-lottery__action\" @click=\"handleAction\"></view>\r\n      <!-- 为了兼容 app 端 ctx.measureText 所需的标签 -->\r\n      <text class=\"almost-lottery__measureText\">{{ measureText }}</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    name: 'RaffleWheel',\r\n    props: {\r\n      // canvas 宽度\r\n      canvasWidth: {\r\n        type: Number,\r\n        default: 240\r\n      },\r\n      // canvas 高度\r\n      canvasHeight: {\r\n        type: Number,\r\n        default: 240\r\n      },\r\n      // 奖品列表\r\n      prizeList: {\r\n        type: Array,\r\n        // 必须是偶数\r\n        validator: function(value) {\r\n          return value.length % 2 === 0\r\n        },\r\n        required: true\r\n      },\r\n      // 奖品区块对应背景颜色\r\n      colors: {\r\n        type: Array,\r\n        default: () => [\r\n          '#FFFFFF',\r\n          '#FFE9AA'\r\n        ],\r\n        // 必须是偶数且仅为 2 个颜色相互交替\r\n        validator: function(value) {\r\n          return value.length === 2\r\n        }\r\n      },\r\n      // 旋转动画时间 单位s\r\n      duration: {\r\n        type: Number,\r\n        default: 8\r\n      },\r\n      // 旋转的圈数\r\n      ringCount: {\r\n        type: Number,\r\n        default: 8\r\n      },\r\n      // 字体颜色\r\n      fontColor: {\r\n        type: String,\r\n        default: '#C30B29'\r\n      },\r\n      // 文字的大小\r\n      fontSize: {\r\n        type: Number,\r\n        default: 12\r\n      },\r\n      // 奖品文字多行情况下的行高\r\n      lineHeight: {\r\n        type: Number,\r\n        default: 20\r\n      },\r\n      // 奖品名称所对应的 key 值\r\n      strKey: {\r\n        type: String,\r\n        required: true\r\n      },\r\n      // 奖品文字总长度限制\r\n      strMaxLength: {\r\n        type: Number,\r\n        default: 12\r\n      },\r\n      // 奖品文字多行情况下第一行文字长度\r\n      strLineLength: {\r\n        type: Number,\r\n        default: 6\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        // 画板className\r\n        className: 'almost-lottery__canvas',\r\n        // 画板标识\r\n        canvasId: 'almostLotteryCanvas',\r\n        // 画板导出的图片\r\n        canvasImg: '',\r\n        // 旋转到奖品目标需要的角度\r\n        targetAngle: 0,\r\n        // 旋转动画时间 单位 s\r\n        transitionDuration: 0,\r\n        // 是否正在旋转\r\n        isRotate: false,\r\n        // 当前停留在那个奖品的序号\r\n        stayIndex: 0,\r\n        // 解决 app 不支持 measureText 的问题\r\n        measureText: ''\r\n      }\r\n    },\r\n    computed: {\r\n      // 设备像素密度\r\n      pixelRatio() {\r\n        return uni.getSystemInfoSync().pixelRatio\r\n      },\r\n      // 根据奖品列表计算 canvas 旋转角度\r\n      // 让 启动按钮指针 在奖品分区中间 position = 45\r\n      // 让 启动按钮指针 在奖品分区边界 position = 90\r\n      canvasAngle() {\r\n        let prizeCount = this.prizeList.length\r\n        let position = 90\r\n        if (prizeCount % 4 !== 0) {\r\n          return 0\r\n        } else {\r\n          let num = prizeCount / 4\r\n          return num % 2 === 0 ? position / num : position\r\n        }\r\n      },\r\n      // 根据画板的宽度计算奖品文字与中心点的距离\r\n      textRadius() {\r\n        return Math.round(this.canvasWidth / 2.4)\r\n      }\r\n    },\r\n    methods: {\r\n      // 开始旋转\r\n      handleStartRotate(targetIndex) {\r\n        // 奖品总数\r\n        let prizeCount = this.prizeList.length\r\n        let baseAngle = 360 / prizeCount\r\n        let angles = 0\r\n        if (this.targetAngle === 0) {\r\n          console.log('第一次旋转')\r\n          // 因为第一个奖品是从0°开始的，即水平向右方向\r\n          // 第一次旋转角度 = 270度 - (停留的序号-目标序号) * 每个奖品区间角度 - 每个奖品区间角度的一半 - canvas自身旋转的度数\r\n          angles = (270 - (targetIndex - this.stayIndex) * baseAngle - baseAngle / 2) - this.canvasAngle\r\n        } else {\r\n          console.log('后续旋转')\r\n          // 后续继续旋转 就只需要计算停留的位置与目标位置的角度\r\n          angles = -(targetIndex - this.stayIndex) * baseAngle\r\n        }\r\n        // 更新目前序号\r\n        this.stayIndex = targetIndex\r\n        // 转 8 圈，圈数越多，转的越快\r\n        this.targetAngle += angles + 360 * this.ringCount\r\n\r\n        // 计算转盘结束对时间，预加一些延迟确保转盘停止后触发结束事件\r\n        let endTime = this.transitionDuration * 1000 + 100\r\n        setTimeout(() => {\r\n          this.isRotate = false\r\n          this.$emit('actionEnd')\r\n        }, endTime)\r\n      },\r\n      // 点击 开始抽奖 按钮\r\n      handleAction() {\r\n        if (this.isRotate) return\r\n        this.isRotate = true\r\n        this.$emit('actionStart')\r\n      },\r\n      // 渲染转盘\r\n      async drawWheelCanvas() {\r\n        // 获取 canvas 画布\r\n        const canvasId = this.canvasId\r\n        const ctx = uni.createCanvasContext(canvasId, this)\r\n\r\n        // canvas 的宽高\r\n        let canvasW = this.canvasWidth\r\n        let canvasH = this.canvasHeight\n        \r\n        // 根据奖品个数计算 角度\r\n        let prizeCount = this.prizeList.length\r\n        let baseAngle = Math.PI * 2 / prizeCount\r\n\r\n        // 设置描边颜色\r\n        ctx.setStrokeStyle('#FFBE04')\r\n        \n        // 设置字体和字号\n        // #ifndef MP\n        let fontFamily = '-apple-system, BlinkMacSystemFont, \\'PingFang SC\\', \\'Helvetica Neue\\', STHeiti, \\'Microsoft Yahei\\', Tahoma, Simsun, sans-serif'\n        ctx.font = `${this.fontSize}px ${fontFamily}`\n        // #endif\n        // #ifdef MP\n        ctx.setFontSize(this.fontSize)\n        // #endif\r\n\r\n        // 注意，开始画的位置是从0°角的位置开始画的。也就是水平向右的方向。\r\n        // 画具体内容\r\n        for (let i = 0; i < prizeCount; i++) {\r\n          // 当前角度\r\n          let angle = i * baseAngle\r\n\r\n          // 保存当前画布的状态\r\n          ctx.save()\r\n\r\n          // 开始画内容\r\n          ctx.beginPath()\r\n\r\n          // 开始画圆弧\r\n          // x => 圆弧对应的圆心横坐标 x\r\n          // y => 圆弧对应的圆心横坐标 y\r\n          // radius => 圆弧的半径大小\r\n          // startAngle => 圆弧开始的角度，单位是弧度\r\n          // endAngle => 圆弧结束的角度，单位是弧度\r\n          // anticlockwise(可选) => 绘制方向，true 为逆时针，false 为顺时针\r\n          let outsideRadius = canvasW / 2\r\n          let insideRadius = 20\r\n          ctx.arc(canvasW * 0.5, canvasH * 0.5, outsideRadius, angle, angle + baseAngle, false)\r\n          ctx.arc(canvasW * 0.5, canvasH * 0.5, insideRadius, angle + baseAngle, angle, true)\r\n\r\n          // 开始链接线条\r\n          ctx.stroke()\r\n          // 每个奖品区块背景填充颜色\n          ctx.setFillStyle(this.colors[i % 2])\r\n          // 填充颜色\r\n          ctx.fill()\r\n\r\n          // 开始绘制奖品内容\r\n          ctx.setFillStyle(this.fontColor)\r\n          let rewardName = this.strLimit(this.prizeList[i][this.strKey])\r\n\r\n          // translate方法重新映射画布上的 (0,0) 位置\r\n          let translateX = canvasW * 0.5 + Math.cos(angle + baseAngle / 2) * this.textRadius\r\n          let translateY = canvasH * 0.5 + Math.sin(angle + baseAngle / 2) * this.textRadius\r\n          ctx.translate(translateX, translateY)\r\n\r\n          // rotate方法旋转当前的绘图，因为文字是和当前扇形中心线垂直的\r\n          ctx.rotate(angle + (baseAngle / 2) + (Math.PI / 2))\r\n\r\n          // 设置文本位置并处理换行\r\n\r\n          // 是否需要换行\r\n          let isLineBreak = rewardName.length > this.strLineLength\r\n          if (isLineBreak) {\r\n            // 获得多行文本数组\r\n            rewardName = rewardName.substring(0, this.strLineLength) + ',' + rewardName.substring(this.strLineLength)\r\n            let rewardNames = rewardName.split(',')\r\n\r\n            // 循环文本数组，计算每一行的文本宽度\r\n            for (let j = 0; j < rewardNames.length; j++) {\r\n              if (ctx.measureText && ctx.measureText(rewardNames[j]).width) {\r\n                // 文本的宽度信息\r\n                let tempStrSize = ctx.measureText(rewardNames[j])\r\n                ctx.fillText(rewardNames[j], -tempStrSize.width / 2, j * this.lineHeight)\r\n              } else {\r\n                this.measureText = rewardNames[j]\r\n\r\n                // 等待页面重新渲染\r\n                await this.$nextTick()\r\n\r\n                let textWidth = await this.getTextWidth()\r\n\r\n                ctx.fillText(rewardNames[j], -textWidth / 2, j * this.lineHeight)\r\n                // console.log(rewardNames[j], textWidth, i)\r\n              }\r\n            }\r\n          } else {\r\n            if (ctx.measureText && ctx.measureText(rewardName).width) {\r\n              // 文本的宽度信息\r\n              let tempStrSize = ctx.measureText(rewardName)\r\n              ctx.fillText(rewardName, -tempStrSize.width / 2, 0)\r\n            } else {\r\n              this.measureText = rewardName\r\n\r\n              // 等待页面重新渲染\r\n              await this.$nextTick()\r\n\r\n              let textWidth = await this.getTextWidth()\r\n\r\n              ctx.fillText(rewardName, -textWidth / 2, 0)\r\n            }\r\n          }\r\n\r\n          ctx.restore()\r\n        }\r\n\r\n        // 保存绘图并导出图片\r\n        ctx.draw(true, () => {\r\n          let drawTimer = setTimeout(() => {\n            clearTimeout(drawTimer)\n            drawTimer = null\n            \n            // #ifdef MP-ALIPAY\n            ctx.toTempFilePath({\n              destWidth: this.canvasWidth * this.pixelRatio,\n              destHeight: this.canvasHeight * this.pixelRatio,\n              success: (res) => {\n                // console.log(res.filePath)\n                this.canvasImg = res.filePath\n                // 通知父级组件，抽奖转品生成图片完成\n                this.$emit('done')\n              }\n            })\n            // #endif\n            // #ifndef MP-ALIPAY\n            uni.canvasToTempFilePath({\n              destWidth: this.canvasWidth * this.pixelRatio,\n              destHeight: this.canvasHeight * this.pixelRatio,\n              canvasId: this.canvasId,\n              success: (res) => {\n                // 在 H5 平台下，tempFilePath 为 base64\n                // console.log(res.tempFilePath)\n                this.canvasImg = res.tempFilePath\n                // 通知父级组件，抽奖转品生成图片完成\n                this.$emit('done')\n              }\n            }, this)\n            // #endif\n          }, 20)\r\n        })\r\n      },\r\n      // 兼容 app 端不支持 ctx.measureText\r\n      // 已知问题：初始绘制时，低端安卓机 平均耗时 2s\r\n      getTextWidth() {\r\n        return new Promise((resolve, reject) => {\r\n          uni.createSelectorQuery().in(this).select('.almost-lottery__measureText').fields({\r\n            size: true,\r\n          }, (res) => {\r\n            resolve(res.width)\r\n          }).exec()\r\n        })\r\n      },\r\n      // 处理文字溢出\r\n      strLimit(value) {\r\n        let maxLength = this.strMaxLength\r\n        if (!value || !maxLength) return value\r\n        return value.length > maxLength ? value.slice(0, maxLength - 1) + '...' : value\r\n      }\r\n    },\r\n    mounted() {\r\n      this.$nextTick(() => {\r\n        let stoTimer = setTimeout(() => {\n          clearTimeout(stoTimer)\n          stoTimer = null\n          \r\n          this.drawWheelCanvas()\r\n          this.transitionDuration = this.duration\r\n        }, 50)\r\n      })\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  $actionBgUrl: '~static/almost-lottery/almost-lottery__action';\r\n  $raffleBgUrl: '~static/almost-lottery/almost-lottery__bg';\r\n\r\n  .almost-lottery {\r\n    position: relative;\r\n    left: 0;\r\n    top: 0;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .almost-lottery {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    margin: 0 auto;\r\n    background-repeat: no-repeat;\r\n    background-position: center center;\r\n    background-size: contain;\r\n    background-image: url($raffleBgUrl + \".png\");\r\n\r\n    @media (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {\r\n      background-image: url($raffleBgUrl + \"@2x.png\");\r\n    }\r\n\r\n    @media (-webkit-min-device-pixel-ratio: 3),\r\n    (min-device-pixel-ratio: 3) {\r\n      background-image: url($raffleBgUrl + \"@3x.png\");\r\n    }\r\n  }\r\n\r\n  .almost-lottery__canvas {\r\n    position: absolute;\r\n    left: -9999px;\r\n    opacity: 0;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .almost-lottery__action {\r\n    position: absolute;\r\n    top: calc(50% - 58px);\r\n    left: calc(50% - 58px);\r\n    width: 114px;\r\n    height: 114px;\r\n    background-repeat: no-repeat;\r\n    background-position: center center;\r\n    background-size: contain;\r\n    background-image: url($actionBgUrl + \".png\");\r\n\r\n    @media (-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2) {\r\n      background-image: url($actionBgUrl + \"@2x.png\");\r\n    }\r\n\r\n    @media (-webkit-min-device-pixel-ratio: 3),\r\n    (min-device-pixel-ratio: 3) {\r\n      background-image: url($actionBgUrl + \"@3x.png\");\r\n    }\r\n  }\r\n\r\n  .almost-lottery__measureText {\r\n    position: absolute;\r\n    left: 0;\r\n    top: 0;\r\n    white-space: nowrap;\r\n    font-size: 12px;\r\n    opacity: 0;\r\n  }\r\n\r\n  .canvas-img {\r\n    transition: transform cubic-bezier(.34, .12, .05, .95);\r\n  }\r\n</style>\n","import mod from \"-!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./almost-lottery.vue?vue&type=style&index=0&id=861fe3f8&lang=scss&scoped=true&\"; export default mod; export * from \"-!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Backup\\\\Downloads\\\\HBuilderX.2.8.1.20200721-alpha.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./almost-lottery.vue?vue&type=style&index=0&id=861fe3f8&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1597390795368\n      var cssReload = require(\"D:/Backup/Downloads/HBuilderX.2.8.1.20200721-alpha.full/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}